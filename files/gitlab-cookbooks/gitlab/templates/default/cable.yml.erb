production:
  <%- if @redis_extra_config_command -%>
  config_command: "<%= @redis_extra_config_command %>"
  <%- end -%>
  adapter: redis
  url: <%= @redis_url %>
  <% if !@redis_enable_client %>
  id:
  <% end %>
  <%- if @redis_ssl %>
  <%# For redis-rb v5+, if Sentinel is enabled the ssl flag is needed because rediss:// is ignored in URL (see https://github.com/redis-rb/redis-client/pull/277). %>
  ssl: true
  ssl_params:
    <%- if @redis_tls_ca_cert_dir %>ca_path: "<%= @redis_tls_ca_cert_dir %>"<% end %>
    <%- if @redis_tls_ca_cert_file %>ca_file: "<%= @redis_tls_ca_cert_file %>"<% end %>
    <%- if @redis_tls_client_cert_file %>cert_file: "<%= @redis_tls_client_cert_file %>"<% end %>
    <%- if @redis_tls_client_key_file %>key_file: "<%= @redis_tls_client_key_file %>"<% end %>
  <% end %>
  <% unless @redis_sentinels.empty? %>
  <%- if @redis_sentinels_password %>
  sentinel_password: "<%= @redis_sentinels_password %>"
  <%- end -%>
  sentinels:
    <% @redis_sentinels.each do |sentinel| %>
    -
      host: <%= sentinel['host'] %>
      port: <%= sentinel['port'] %>
      <%- if @redis_sentinels_ssl %>
      ssl: true
      ssl_params:
        <%- if @redis_sentinels_tls_ca_cert_file %>ca_file: "<%= @redis_sentinels_tls_ca_cert_file %>"<% end %>
        <%- if @redis_sentinels_tls_client_cert_file %>cert: "<%= @redis_sentinels_tls_client_cert_file %>"<% end %>
        <%- if @redis_sentinels_tls_client_key_file %>key: "<%= @redis_sentinels_tls_client_key_file %>"<% end %>
      <%- end -%>
    <% end %>
  <% end %>
